<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Non Hosted Payment Page</title>

    <!-- Bootstrap 5 CSS only -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css"
        integrity="sha384-DhY6onE6f3zzKbjUPRc2hOzGAdEf4/Dz+WJwBvEYL/lkkIsI3ihufq9hk9K4lVoK" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{url_for('static', filename='css/paydee.css')}}">

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col">

                <form id="form2" method="POST" action="https://devlink.paydee.co/mpi/mercReq">
                    <button class="btn btn-sm btn-light btn-block mb-4 p-0 text-decoration-underline" type="button" form="form1" onclick="Hosted()">
                        < To Hosted Payment Page
                    </button>     
                    <div class="form-group m-0 p-0 ">
                        {{ form.MPI_MAC(class="form-control form-control-sm", type='hidden') }}
                    </div>
                    <div class="form-group m-0 p-0 ">
                        {{ form.MPI_PURCH_AMT(class="form-control form-control-sm", type='hidden') }}
                    </div>
                    <div class="form-group m-0 p-0 ">
                        {{ form.MPI_PURCH_CURR(class="form-control form-control-sm", type='hidden') }}
                    </div>   
                    <div class="form-group m-0 p-0 ">
                        {{ form.MPI_MERC_ID(class="form-control form-control-sm", type='hidden') }}
                    </div>
                    <div class="form-group m-0 p-0 invisible">
                        {{ form.MPI_TRANS_TYPE(class="form-control form-control-sm", type='hidden') }}
                    </div>   
                    <div class="form-group m-0 p-0 ">
                        {{ form.MPI_PURCH_DATE(class="form-control form-control-sm", type='hidden') }}
                    </div>    
                    <div class="form-group m-0 p-0 ">
                        {{ form.MPI_TRXN_ID(class="form-control form-control-sm", type='hidden') }}
                    </div>                                                                         
                </form>

                <p class="font-weight-light text-center font-italic">Sample Non Hosted Payment Page</p>
                <form id="form1" method="POST" action="https://devlink.paydee.co/mpi/mpReq">
                    {{ form.hidden_tag() }}
                    <fieldset>
                        
                        <div class="form-group my-1">
                            {% if form.MPI_CARD_HOLDER_NAME.errors %}
                            {{ form.MPI_CARD_HOLDER_NAME(class="form-control form-control-lg is-invalid") }}
                            {% for error in form.MPI_CARD_HOLDER_NAME.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                            {% else %}
                            {{ form.MPI_CARD_HOLDER_NAME(class="form-control form-control-sm") }}
                            {% endif %}
                        </div>

                        <div class="form-group my-1">
                            {% if form.MPI_PAN.errors %}
                            {{ form.MPI_PAN(class="form-control form-control-sm is-invalid") }}
                            {% for error in form.MPI_PAN.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                            {% else %}
                            {{ form.MPI_PAN(class="form-control form-control-sm") }}
                            {% endif %}
                        </div>

                        <div class="form-group my-1">
                            {% if form.MPI_PAN_EXP.errors %}
                            {{ form.MPI_PAN_EXP(class="form-control form-control-sm is-invalid") }}
                            {% for error in form.MPI_PAN_EXP.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                            {% else %}
                            {{ form.MPI_PAN_EXP(class="form-control form-control-sm") }}
                            {% endif %}
                        </div>

                        <div class="form-group my-1">
                            {% if form.MPI_CVV2.errors %}
                            {{ form.MPI_CVV2(class="form-control form-control-sm is-invalid") }}
                            {% for error in form.MPI_CVV2.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                            {% else %}
                            {{ form.MPI_CVV2(class="form-control form-control-sm") }}
                            {% endif %}
                        </div>

                        <button class="mt-2 btn btn-teal btn-sm btn-block" type="button" form="form1" onclick="PayNow()">
                            Pay Now :)
                        </button>

                        <div class="form-group m-0 p-0 ">
                            {{ form.MPI_MAC(class="form-control form-control-sm m-0 p-0", type='hidden') }}
                        </div>
                        <div class="form-group m-0 p-0 ">
                            {{ form.MPI_PURCH_AMT(class="form-control form-control-sm  m-0 p-0", type='hidden') }}
                        </div>
                        <div class="form-group m-0 p-0 ">
                            {{ form.MPI_PURCH_CURR(class="form-control form-control-sm ", type='hidden') }}
                        </div>   
                        <div class="form-group m-0 p-0 ">
                            {{ form.MPI_MERC_ID(class="form-control form-control-sm  m-0 p-0", type='hidden') }}
                        </div>
                        <div class="form-group m-0 p-0 invisible">
                            {{ form.MPI_TRANS_TYPE(class="form-control form-control-sm  m-0 p-0", type='hidden') }}
                        </div>   
                        <div class="form-group m-0 p-0">
                            {{ form.MPI_PURCH_DATE(class="form-control form-control-sm  m-0 p-0", type='hidden') }}
                        </div>    
                        <div class="form-group m-0 p-0">
                            {{ form.MPI_TRXN_ID(class="form-control form-control-sm  m-0 p-0", type='hidden') }}
                        </div>                                                                      
                    </fieldset>
                </form> 
            </div>
        </div>
    </div>
</body>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.bundle.min.js"
    integrity="sha384-BOsAfwzjNJHrJ8cZidOg56tcQWfp6y72vEJ8xQ9w6Quywb24iOsW913URv1IS4GD"
    crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>

    function Hosted() {
        console.log('Hosted')
        var f = document.forms["form2"];

        $.ajax({
            type: "POST",
            url: "sign_data",
            data: $('#form2').serialize(),
            success: function (response) {
                var result = response;
                if (result != " ") {
                    f.MPI_MAC.value = result;
                    f.MPI_PURCH_AMT.value = "10000";
                    f.MPI_PURCH_CURR.value = "458";
                    f.MPI_MERC_ID.value = "000000000000033"
                    f.MPI_TRANS_TYPE = "SALES";

                    f.submit();

                } else {
                    alert("Failed to sign the data.");
                }
            },
            error: function (e) {
                alert("Failed to sign the data. Please try again.");
            }
        });
    }


    function PayNow() {
        console.log('Signing the data')
        var f = document.forms["form1"];

        $.ajax({
            type: "POST",
            url: "sign_data_nonhosted",
            data: $('#form1').serialize(),
            success: function (response) {
                var result = response;
                console.log("result>>>")
                console.log(result)
                if (result != " ") {
                    f.MPI_MAC.value = result;
                    f.MPI_PURCH_AMT.value = "10000";
                    f.MPI_PURCH_CURR.value = "458";
                    f.MPI_MERC_ID.value = "000000000000033"
                    f.MPI_TRANS_TYPE = "SALES";
                                        
                    f.submit();

                } else {
                    alert("Failed to sign the data.");
                }
            },
            error: function (e) {
                alert("Failed to sign the data. Please try again.");
            }
        });
    }


</script>

</html>